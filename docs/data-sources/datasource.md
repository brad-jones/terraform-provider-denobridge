---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "denobridge_datasource Data Source - terraform-provider-denobridge"
subcategory: ""
description: |-
  Bridges the terraform-plugin-framework Datasource to a Deno HTTP Server.
---

# denobridge_datasource (Data Source)

Bridges the terraform-plugin-framework Datasource to a Deno HTTP Server.

## Example Usage

```terraform
data "denobridge_datasource" "deno_ip" {
  # The path to the underlying deno script.
  # Remote HTTP URLs also supported! Any valid value that `deno serve` will accept.
  path = "${path.module}/data-source.ts"

  # The inputs required by the underlying deno script to read the data.
  props = {
    query = "deno.com."
    recordType = "A"
  }

  # Optionally provide a path to a deno config file.
  #
  # If none is given, the denobridge provider will attempt to locate the closest
  # config file relative to the script path. This is to ensure that things like
  # import maps work as expected.
  #
  # If you wish to opt out of this automatic config discovery, supply the path "/dev/null".
  config_file = "/path/to/deno.json"

  # Optionally set any runtime permissions that the deno script may require.
  permissions = {
    all = true # Maps to --allow-all (use with caution!)

    # Otherwise provide the exact permissions your script needs.
    # see: https://docs.deno.com/runtime/fundamentals/security/#permissions
    allow = ["read", "net=example.com:443"]
    deny = ["write"]
  }
}

resource "foo" "bar" {
  # The results are again untyped and dynamic based on the deno script returned
  # In this example we would receive the IP address from the A lookup against deno.com
  ip_address = data.denobridge_datasource.deno_ip.result[0]
}
```

<!-- schema generated by tfplugindocs -->

## Schema

### Required

- `path` (String) Path to the Deno script to execute.

### Optional

- `config_file` (String) File path to a deno config file to use with the deno script. Useful for import maps, etc...
- `permissions` (Attributes) Deno runtime permissions for the script. (see [below for nested schema](#nestedatt--permissions))
- `props` (Dynamic) Input properties to pass to the Deno script.

### Read-Only

- `result` (Dynamic) Output data returned from the Deno script.

<a id="nestedatt--permissions"></a>

### Nested Schema for `permissions`

Optional:

- `all` (Boolean) Grant all permissions.
- `allow` (List of String) List of permissions to allow (e.g., 'read', 'write', 'net').
- `deny` (List of String) List of permissions to deny.

## OpenAPI Specification

HTTP API contract for Terraform `denobridge_datasource` implementations.

This specification defines the endpoints that a Deno TypeScript script must implement
to provide data source functionality in Terraform.

Data sources are read-only and are used to fetch external data that can be used
elsewhere in Terraform configuration. The provider will start your Deno script
as an HTTP server and call the `/read` endpoint to fetch data.

```yaml
openapi: 3.1.0
info:
  title: DenoBridge Datasource API
  version: 1.0.0

servers:
  - url: http://localhost:{port}
    description: Local Deno HTTP server (port assigned dynamically)
    variables:
      port:
        default: "0"
        description: Port dynamically assigned by the provider

paths:
  /health:
    get:
      summary: Health check endpoint
      description: |
        The provider polls this endpoint until it receives a successful response
        before attempting to call any other endpoints.
      responses:
        "204":
          description: |
            Server is ready to accept requests.
            NB: 200 is also accepted for flexibility.

  /read:
    post:
      summary: Fetch data from the data source
      description: |
        Retrieves data based on the provided input properties.

        Data sources are read-only and do not create or modify any infrastructure.
        They are evaluated during the plan phase and used to fetch external data
        that can be referenced in other Terraform resources.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - props
              properties:
                props:
                  type: object
                  description: Input properties that specify what data to fetch
                  additionalProperties: true
            example:
              props:
                value: "example-string"
      responses:
        "200":
          description: Data fetched successfully
          content:
            application/json:
              schema:
                type: object
                description: The fetched data that will be available to Terraform
                additionalProperties: true
              example:
                hashedValue: "50d858e0985ecc7f60418aaf0cc5ab587f42c2570a884095a9e8ccacd0f6545c"
        "4XX":
          description: Client error during data fetch
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "5XX":
          description: Server error during data fetch
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

components:
  schemas:
    Error:
      type: object
      properties:
        error:
          type: string
          description: Error message describing what went wrong
```

## Example Server

This shows how one might fulfil the above OpenAPI specification.

The script **MUST** export a `default` export that satisfies `Deno.ServeDefaultExport`.
So that it can be executed with [`deno serve`](https://docs.deno.com/runtime/reference/cli/serve/).

_NB: Using Hono is not a requirement, your welcome to use your favorite HTTP server library._

```ts
import { Hono } from "jsr:@hono/hono";

const app = new Hono();

app.get("/health", (c) => {
  return c.body(null, 204);
});

app.post("/read", async (c) => {
  const body = await c.req.json();
  const { query, recordType } = body.props;
  const result = await Deno.resolveDns(query, recordType, {
    nameServer: { ipAddr: "1.1.1.1", port: 53 },
  });
  return c.json(result);
});

export default app satisfies Deno.ServeDefaultExport;
```

_read more: <https://developer.hashicorp.com/terraform/plugin/framework/data-sources>_
